# The tmux session name, has to be unique
session_name: pt_start

# Add commands to bash history
suppress_history: false

# set environment variables
environment:
  robot: ${robot}
  DISPLAY: ":0"
  QT_X11_NO_MITSHM: "1"
# starting directory location, to run all commands from
start_directory: /home/developer/javis_ws/

# commands to run before panes startup
before_script: /home/developer/javis_ws/operations/javis_utils/scripts/tmux_bootstrap.bash -sp -ar -st -- javis_whipser

# This is where we list all the stuff we want to run
windows:
  # - window_name: network
  #   focus: false
  #   layout: main-horizontal
  #   panes:
  #     - shell_command:
  #       - echo "passme24" | sudo -S ip route replace default via 192.168.1.1 dev eth0

  - window_name: GPS
    focus: false
    layout: main-horizontal
    panes:
      - shell_command:
        - docker-join.bash -n javis_whisper
        - source /home/developer/.bashrc
        - source /home/developer/javis_ws/install/setup.bash
        - cd /home/developer/javis_ws/src/gps_driver_ros2
        # - python3 /home/developer/javis_ws/src/gps_driver_ros2/gps_node.py
        - |
          while true; do
            echo "üöÄ Starting GPS driver..."
            python3 /home/developer/javis_ws/src/gps_driver_ros2/gps_node.py
            echo "‚ùå gps driver crashed ‚Äî restarting in 2 seconds..."
            sleep 2
          done
  - window_name: ODOM
    focus: false
    layout: main-horizontal
    panes:
      - shell_command:
        - docker-join.bash -n javis_whisper
        - source /home/developer/.bashrc
        - source /home/developer/javis_ws/install/setup.bash
        - cd /home/developer/javis_ws/src/gps_driver_ros2
        - python3 /home/developer/javis_ws/src/gps_driver_ros2/gps_to_odom_node.py

  # - window_name: GPS_ODOM
  #   focus: false
  #   layout: main-horizontal
  #   panes:
  #     - shell_command:
  #       - docker-join.bash -n javis_whisper
  #       - source /home/developer/.bashrc
  #       - source /home/developer/javis/install/setup.bash
  #       - cd /home/developer/javis_ws/src/gps_driver_ros2
  #       - python3 gps_driver_with_odom.py
  # - window_name: DEBUG_vel
  #   focus: true
  #   layout: main-horizontal
  #   panes:
  #     - shell_command:
  #       - docker-join.bash -n javis_whisper
  #       - source /home/developer/.bashrc
  #       - source /home/developer/javis_ws/install/setup.bash
  #       - ros2 topic echo /cmd_vel

  # - window_name: DEBUG_waypoint
  #   focus: true
  #   layout: main-horizontal
  #   panes:
  #     - shell_command:
  #       - docker-join.bash -n javis_whisper
  #       - source /home/developer/.bashrc
  #       - source /home/developer/javis_ws/install/setup.bash
  #       - ros2 topic echo /way_point

  - window_name: Lidar
    focus: false
    layout: main-horizontal
    panes:
      - shell_command:
        - docker-join.bash -n javis_whisper
        - source /home/developer/.bashrc
        - source /home/developer/javis_ws/install/setup.bash
        - source /opt/ros/humble/setup.bash
        - source ~/javis_ws/install/setup.bash
        - cd ~/javis_ws
        - |
          while true; do
            echo "üöÄ Starting LSLiDAR driver..."
            ros2 launch lslidar_driver lsn10p_launch.py
            echo "‚ùå LSLiDAR driver crashed ‚Äî restarting in 3 seconds..."
            sleep 3
          done

        # - ros2 launch lslidar_driver lsn10p_launch.py
  # - window_name: Joystick
  #   focus: false
  #   layout: main-horizontal
  #   panes:
  #     - shell_command:
  #         - export ROS_DOMAIN_ID=10
  #         - |
  #           while true; do
  #             echo 'üöÄ Starting Local Joystick Node...'
  #             python3 /home/developer/javis_ws/src/custom_joystick/custom_joystick.py
  #             echo '‚ùå Joystick crashed ‚Äî restarting in 3 seconds...'
  #             sleep 3
  #           done

  # - window_name: UI
  #   focus: false
  #   layout: main-horizontal
  #   panes:
  #     - shell_command:
  #         - docker-join.bash -n javis_whisper
  #         - source /opt/ros/humble/setup.bash
  #         - export ROS_DOMAIN_ID=10
  #         - cd /home/developer/javis_ws/src/robot_ui
  #         - |
  #           while true; do
  #             echo "üöÄ Starting UI..."
  #             python3 /home/developer/javis_ws/src/robot_ui/robot_ui.py
  #             echo "‚ùå UI node crashed or stopped ‚Äî restarting in 3 seconds..."
  #             sleep 3
  #           done



  - window_name: rosbag
    focus: false
    layout: main-horizontal
    panes:
      - shell_command:
        - docker-join.bash -n javis_whisper
        - source /home/developer/.bashrc
        - cd ~/javis_ws/save_data
        - python3 save_data.py
        # - cd ~/javis_ws/save_data/1021
        # - bash play_bags.sh

  - window_name: global_planner
    focus: false
    layout: main-horizontal
    panes:
      - shell_command:
        - docker-join.bash -n javis_whisper
        - source /home/developer/.bashrc
        - source /home/developer/javis_ws/install/setup.bash
        - cd /home/developer/javis_ws/src/global_planner/global_planner
        - |
          while true; do
            echo "üöÄ Starting global planner..."
            python3 /home/developer/javis_ws/src/global_planner/global_planner/global_planner.py
            echo "‚ùå global planner node crashed or stopped ‚Äî restarting in 3 seconds..."
            sleep 3
          done
  - window_name: far_planner
    focus: false
    layout: main-horizontal
    panes:
      - shell_command:
        - docker-join.bash -n javis_whisper
        - source /home/developer/.bashrc
        - source /home/developer/javis_ws/install/setup.bash
        - cd /home/developer/javis_ws/src/global_planner/global_planner
        - |
          while true; do
            echo "üöÄ Starting far planner..."
            python3 /home/developer/javis_ws/src/global_planner/global_planner/far_planner.py
            echo "‚ùå far planner node crashed or stopped ‚Äî restarting in 3 seconds..."
            sleep 3
          done

  - window_name: local_planner
    focus: false
    layout: main-horizontal
    panes:
      - shell_command:
        - docker-join.bash -n javis_whisper
        - source /home/developer/.bashrc
        - source /home/developer/javis_ws/install/setup.bash
        - ros2 launch local_planner local_planner.launch

  - window_name: HEARTBEAT
    focus: false
    layout: main-horizontal
    panes:
      - shell_command:
        - docker-join.bash -n javis_whisper
        - source /home/developer/.bashrc
        - source /home/developer/javis_ws/install/setup.bash
        - cd /home/developer/javis_ws/stream_tts
        - python3 HeartbeatReceiver.py

  - window_name: INPUT_FILTER
    focus: false
    layout: main-horizontal
    panes:
      - shell_command:
        - docker-join.bash -n javis_whisper
        - source /home/developer/.bashrc
        - source /home/developer/javis_ws/install/setup.bash
        - cd /home/developer/javis_ws/src/input_output_filter/input_output_filter
        - |
          while true; do
            echo "üöÄ Starting input filter..."
            python3 /home/developer/javis_ws/src/input_output_filter/input_output_filter/input_filter.py
            echo "‚ùå input filter node crashed or stopped ‚Äî restarting in 3 seconds..."
            sleep 3
          done
  - window_name: OUTPUT_FILTER
    focus: false
    layout: main-horizontal
    panes:
      - shell_command:
        - docker-join.bash -n javis_whisper
        - source /home/developer/.bashrc
        - source /home/developer/javis_ws/install/setup.bash
        - cd /home/developer/javis_ws/src/input_output_filter/input_output_filter
        - |
          while true; do
            echo "üöÄ Starting output filter..."
            python3 /home/developer/javis_ws/src/input_output_filter/input_output_filter/output_filter.py
            echo "‚ùå output filter node crashed or stopped ‚Äî restarting in 3 seconds..."
            sleep 3
          done

  - window_name: LLM
    focus: false
    layout: main-horizontal
    panes:
      - shell_command:
        - docker-join.bash -n javis_whisper
        - source /home/developer/.bashrc
        - source /home/developer/javis_ws/install/setup.bash
        - cd /home/developer/javis_ws/src/llm_server/llm_server/
        - |
          while true; do
            echo "üöÄ Starting LLM node..."
            cd /home/developer/javis_ws/src/llm_server/llm_server/
            python3 server.py
            echo "‚ùå LLM node crashed or stopped ‚Äî restarting in 3 seconds..."
            sleep 3
          done

  - window_name: ASR
    focus: false
    layout: main-horizontal
    panes:
      - shell_command:
        - docker-join.bash -n javis_whisper
        - source /home/developer/.bashrc
        - source /home/developer/javis_ws/install/setup.bash
        - |
          while true; do
            echo "üöÄ Starting asr filter..."
            python3 /home/developer/javis_ws/src/asr/asr/stream_vad_ros2.py
            echo "‚ùå asr node crashed or stopped ‚Äî restarting in 3 seconds..."
            sleep 3
          done


  - window_name: BH
    focus: false
    layout: main-horizontal
    panes:
      - shell_command:
        - docker-join.bash -n javis_whisper
        - source /home/developer/.bashrc
        - source /home/developer/javis_ws/install/setup.bash
        - |
          while true; do
            echo "üöÄ behavior controller filter..."
            python3 /home/developer/javis_ws/src/lite3_udp_ros2_driver/lite3_udp_ros2_driver/behavior_controller.py
            echo "‚ùå behavior contoller node crashed or stopped ‚Äî restarting in 3 seconds..."
            sleep 3
          done

  - window_name: Lite3
    focus: false
    layout: main-horizontal
    panes:
      - shell_command:
        - docker-join.bash -n javis_whisper
        # - sudo sysctl -w net.core.rmem_max=26214400
        - sleep 3
        - source /home/developer/.bashrc
        - source /home/developer/javis_ws/install/setup.bash
        - |
          while true; do
            echo "üöÄ motion server filter..."
            python3 /home/developer/javis_ws/src/lite3_udp_ros2_driver/lite3_udp_ros2_driver/motion_server.py
            echo "‚ùå motion_server node crashed or stopped ‚Äî restarting in 3 seconds..."
            sleep 3
          done
  - window_name: TTS
    focus: false
    layout: main-horizontal
    panes:
      - shell_command:
        - docker run --rm --runtime nvidia -it -v ${HOME}/model_data:/home/developer/model_data -v ${HOME}/javis_ws:/home/developer/javis_ws --network=host dustynv/kokoro-tts:fastapi-r36.4.0

